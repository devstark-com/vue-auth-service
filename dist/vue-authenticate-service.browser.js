!function(root,factory){"object"==typeof exports&&"object"==typeof module?module.exports=factory():"function"==typeof define&&define.amd?define([],factory):"object"==typeof exports?exports.VueAuthenticateService=factory():root.VueAuthenticateService=factory()}(this,function(){return function(modules){function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={i:moduleId,l:!1,exports:{}};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.l=!0,module.exports}var installedModules={};return __webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.i=function(value){return value},__webpack_require__.d=function(exports,name,getter){__webpack_require__.o(exports,name)||Object.defineProperty(exports,name,{configurable:!1,enumerable:!0,get:getter})},__webpack_require__.n=function(module){var getter=module&&module.__esModule?function(){return module.default}:function(){return module};return __webpack_require__.d(getter,"a",getter),getter},__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=2)}([function(module,__webpack_exports__,__webpack_require__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__utils_jwt__=__webpack_require__(3),_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},_this=this,AuthService=function(Vue,_ref){var api=_ref.api,client=_ref.client,_ref$localStorage=_ref.localStorage,localStorage=void 0===_ref$localStorage?window.localStorage:_ref$localStorage,_ref$options=_ref.options,options=void 0===_ref$options?{}:_ref$options,accessToken=null,refreshToken=null;return _this.state=new Vue({data:function(){return{loaded:!1,userData:null,authenticated:null}},watch:{loaded:function(val){val&&this.$emit("loaded",val)},userData:function(val){val&&this.$emit("userDataLoaded",val)},authenticated:function(val){val&&this.$emit("authenticated",val)}}}),{options:_extends({refresh:!1,autoBoot:!0,reloadOnLogout:!0,autoFetch:!0,accessTokenKey:"accessToken",refreshTokenKey:"refreshToken"},options),api:api,client:client,localStorage:localStorage,state:_this.state,isLoaded:function(){return this.state.loaded},whenLoaded:function(){var _this2=this;return new Promise(function(resolve){if(_this2.state.loaded)return resolve(!0);_this2.state.$on("loaded",resolve)})},whenUserDataLoaded:function(){var _this3=this;return new Promise(function(resolve){if(_this3.state.userData)return resolve(_this3.state.userData);_this3.state.$on("userDataLoaded",resolve)})},whenAuthenticated:function(){var _this4=this;return new Promise(function(resolve){if(_this4.state.authenticated)return resolve(_this4.state.authenticated);_this4.state.$on("authenticated",resolve)})},isAuthenticated:function(){return this.state.authenticated},userData:function(){return this.state.userData},updateUserData:function(data){return this.state.userData=data,this.state.userData},boot:function(){client.interceptors(this);var hasLocalTokens=this.loadLocalTokens();if(hasLocalTokens&&this.options.autoFetch)return this.fetchUser().catch(function(){});hasLocalTokens&&this.setAuthenticated(!0),this.setLoaded(!0)},setLoaded:function(loaded){this.state.loaded=!!loaded},setAuthenticated:function(authenticated){this.state.authenticated=!!authenticated},login:function(creds){var _this5=this,loginOptinos=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{fetchUser:!0,remember:!0};return api.login(creds).then(function(tokens){return _this5.loginSuccess(tokens,loginOptinos)}).catch(this.loginError.bind(this))},facebookLogin:function(creds){var _this6=this,loginOptinos=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{fetchUser:!0};return api.facebookLogin(creds).then(function(tokens){return _this6.loginSuccess(tokens,loginOptinos)}).catch(function(){_this6.loginError.bind(_this6)})},googleLogin:function(creds){var _this7=this,loginOptinos=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{fetchUser:!0};return api.googleLogin(creds).then(function(tokens){return _this7.loginSuccess(tokens,loginOptinos)}).catch(function(){_this7.loginError.bind(_this7)})},loginSuccess:function(tokens){var loginOptinos=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{fetchUser:!0};return this.setAuthenticated(!0),this.updateLocalTokens(tokens),loginOptinos.fetchUser?this.fetchUser():Promise.resolve(null)},loginError:function(error){throw error},logout:function(){var creds=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return api.logout?api.logout(creds).then(this.logoutSuccess.bind(this)).catch(this.logoutError.bind(this)):Promise.resolve().then(this.logoutSuccess.bind(this))},logoutSuccess:function(response){return this.clearLocalTokens(),this.setAuthenticated(!1),this.updateUserData(null),this.options.reloadOnLogout&&window.location.reload(),response},logoutError:function(error){throw error},isTokenValid:__WEBPACK_IMPORTED_MODULE_0__utils_jwt__.a,accessToken:function(){var token=this.getLocalAccessToken();if(this.isTokenValid(token))return Promise.resolve(token);if(this.options.refresh){var _refreshToken=this.getLocalRefreshToken();return _refreshToken?this.refresh(_refreshToken).then(function(tokens){return tokens.accessToken}):Promise.reject(new Error("No refresh token"))}return Promise.reject(new Error("No refresh token"))},getLocalAccessToken:function(){return accessToken},setLocalAccessToken:function(token){return localStorage.setItem(this.options.accessTokenKey,token)},getLocalRefreshToken:function(){return refreshToken},setLocalRefreshToken:function(token){return localStorage.setItem(this.options.refreshTokenKey,token)},loadLocalTokens:function(){return accessToken=localStorage.getItem(this.options.accessTokenKey),this.options.refresh&&(refreshToken=localStorage.getItem(this.options.refreshTokenKey)),!!accessToken},updateLocalTokens:function(tokens){return accessToken=tokens.accessToken,this.setLocalAccessToken(tokens.accessToken),this.options.refresh?("access"===this.options.refresh?this.setLocalRefreshToken(tokens.accessToken):this.setLocalRefreshToken(tokens.refreshToken),tokens):tokens},clearLocalTokens:function(){accessToken=null,localStorage.removeItem(this.options.accessTokenKey),this.options.refresh&&(refreshToken=null,localStorage.removeItem(this.options.refreshTokenKey))},refresh:function(refreshToken){return api.refresh(refreshToken).then(this.refreshSuccess.bind(this)).catch(this.refreshError.bind(this))},refreshSuccess:function(tokens){return this.updateLocalTokens(tokens),tokens},refreshError:function(error){throw error},fetchUser:function(){return api.user().then(this.fetchUserSuccess.bind(this)).catch(this.fetchUserError.bind(this))},fetchUserSuccess:function(data){return this.setAuthenticated(!0),this.setLoaded(!0),this.updateUserData(data)},fetchUserError:function(error){throw this.setAuthenticated(!1),this.setLoaded(!0),this.updateUserData(null),error}}};__webpack_exports__.a=AuthService},function(module,exports){var g,_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};g=function(){return this}();try{g=g||Function("return this")()||(0,eval)("this")}catch(e){"object"===("undefined"==typeof window?"undefined":_typeof(window))&&(g=window)}module.exports=g},function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0}),function(global){var __WEBPACK_IMPORTED_MODULE_0__service__=__webpack_require__(0);__webpack_require__.d(__webpack_exports__,"service",function(){return __WEBPACK_IMPORTED_MODULE_0__service__.a});var plugin={version:"0.5.0",install:function(Vue,options){var serviceInstance=__webpack_require__.i(__WEBPACK_IMPORTED_MODULE_0__service__.a)(options);return options.autoBoot&&serviceInstance.boot(),serviceInstance}};__webpack_exports__.default=plugin;var GlobalVue=null;"undefined"!=typeof window?GlobalVue=window.Vue:void 0!==global&&(GlobalVue=global.Vue),GlobalVue&&GlobalVue.use(plugin)}.call(__webpack_exports__,__webpack_require__(1))},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return isTokenValid});var __WEBPACK_IMPORTED_MODULE_0_jwt_decode__=__webpack_require__(6),__WEBPACK_IMPORTED_MODULE_0_jwt_decode___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_jwt_decode__),now=function(){return new Date/1e3|0},isTokenValid=function(token){if(!token)return!1;try{return __WEBPACK_IMPORTED_MODULE_0_jwt_decode___default()(token).exp>now()}catch(e){return!1}}},function(module,exports){function InvalidCharacterError(message){this.message=message}function polyfill(input){var str=String(input).replace(/=+$/,"");if(str.length%4==1)throw new InvalidCharacterError("'atob' failed: The string to be decoded is not correctly encoded.");for(var bs,buffer,bc=0,idx=0,output="";buffer=str.charAt(idx++);~buffer&&(bs=bc%4?64*bs+buffer:buffer,bc++%4)?output+=String.fromCharCode(255&bs>>(-2*bc&6)):0)buffer=chars.indexOf(buffer);return output}var chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";InvalidCharacterError.prototype=new Error,InvalidCharacterError.prototype.name="InvalidCharacterError",module.exports="undefined"!=typeof window&&window.atob&&window.atob.bind(window)||polyfill},function(module,exports,__webpack_require__){function b64DecodeUnicode(str){return decodeURIComponent(atob(str).replace(/(.)/g,function(m,p){var code=p.charCodeAt(0).toString(16).toUpperCase();return code.length<2&&(code="0"+code),"%"+code}))}var atob=__webpack_require__(4);module.exports=function(str){var output=str.replace(/-/g,"+").replace(/_/g,"/");switch(output.length%4){case 0:break;case 2:output+="==";break;case 3:output+="=";break;default:throw"Illegal base64url string!"}try{return b64DecodeUnicode(output)}catch(err){return atob(output)}}},function(module,exports,__webpack_require__){"use strict";function InvalidTokenError(message){this.message=message}var base64_url_decode=__webpack_require__(5);InvalidTokenError.prototype=new Error,InvalidTokenError.prototype.name="InvalidTokenError",module.exports=function(token,options){if("string"!=typeof token)throw new InvalidTokenError("Invalid token specified");options=options||{};var pos=!0===options.header?0:1;try{return JSON.parse(base64_url_decode(token.split(".")[pos]))}catch(e){throw new InvalidTokenError("Invalid token specified: "+e.message)}},module.exports.InvalidTokenError=InvalidTokenError}])});